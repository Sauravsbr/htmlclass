(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[453],{2633:function(e,t,n){"use strict";n.d(t,"e",function(){return r});n.d(t,"t",function(){return i});n.d(t,"r",function(){return s});var r,i;(function(e){e.hls="hls";e.hlsV6="hlsV6";e.dash="dash";e.mp4="htmlMp4"})(r||(r={}));(function(e){e.none="none";e.flashDash="flashDash";e.flashMp4="flashMp4";e.flashPending="flashPending";e.htmlMp4="htmlMp4";e.htmlDashling="htmlDashling";e.htmlDashlingMediaFoundationFallback="htmlDashlingMediaFoundationFallback";e.htmlHls="htmlHls";e.htmlHlsMediaFoundationFallback="htmlHlsMediaFoundationFallback";e.htmlFallback="htmlFallback";e.htmlDashlingFFMPEGFallback="htmlDashlingFFMPEGFallback";e.htmlHlsFFMPEGFallback="htmlHlsFFMPEGFallback";e.htmlHlsV6="htmlHlsV6";e.htmlHlsV6MediaFoundationFallback="htmlHlsV6MediaFoundationFallback";e.htmlHlsV6FFMPEGFallback="htmlHlsV6FFMPEGFallback"})(i||(i={}));function s(e){return e===i.htmlMp4||e===i.htmlFallback||e===i.flashMp4?r.mp4:e===i.htmlHls||e===i.htmlHlsMediaFoundationFallback||e===i.htmlHlsFFMPEGFallback?r.hls:e===i.htmlHlsV6||e===i.htmlHlsV6MediaFoundationFallback||e===i.htmlHlsV6FFMPEGFallback?r.hlsV6:r.dash}t.n=i},5433:function(e,t,n){"use strict";n.r(t);n.d(t,"resourceKey",function(){return O});var r=n(0),i=n(91),s=n(119),o=n(783),u=n(923),a=n(29),f=n(901),l=n(88),c=n(63),h=n(13),p=n(496),d=n(1256),v=n(33),m=n(2877),g=n(2633),y=n(82),b=n(36),w=n(202),E=n(921),S=n(70),x=n(327),T=n(196),N=n(87),C=n(52),k=(function(){function e(e,t){this._downloadDataSource=t.downloadDataSource;this._graphDataSource=t.graphDataSource;this._itemUrlHelper=t.itemUrlHelper;this._pageContext=t.pageContext;this._tokenFetcher=t.tokenFetcher;this._cached=null;this._isTranscriptVroomEnabled=t.isTranscriptVroomEnabled}e.prototype.isStreamingSupported=function(e){return!!(e&&e.urls&&e.urls[o.t.video])};e.prototype.isMetaAvailable=function(e){return!(!e||!e.urls||!e.urls[o.t.mediaBaseUrl]&&!e.urls[o.t.video])};e.prototype.isDownloadBlocked=function(e){return 4===e.itemStatus||!a.e.hasItemPermission(e,a.e.openItems)};e.prototype.isHlsPlaybackSupported=function(){return Object(v.isFeatureEnabled)(v.EnableHlsPretranscode)};e.prototype.getDownloadUrl=function(e){var t=e.item,n=e.playbackType,r=e.preferEncryption,s=e.enhanceAudio,u=e.forcedCdnParam,a=n===g.n.htmlMp4||n===g.n.htmlFallback;if(this.isStreamingSupported(t)&&!a){var f=t.urls[o.t.video],l=this._getFormat(n);if(f&&l){f+="&part=index&format=".concat(l,"&useScf=True");if(!e.useBetaTranscode||n!==g.n.htmlDashling&&n!==g.n.htmlDashlingFFMPEGFallback&&n!==g.n.flashDash&&n!==g.n.htmlHlsV6&&n!==g.n.htmlHlsV6FFMPEGFallback)f+="&manifestMetadata="+(t.video&&t.video.manifestMetadata||"");else{f+="&altTranscode=1";f+="&altManifestMetadata="+(t.video&&t.video.altManifestMetadata||"")}!s||n!==g.n.htmlDashling&&n!==g.n.htmlHlsV6||(f+="&enhanceAudio=true");if(n===g.n.htmlDashling||n===g.n.htmlDashlingMediaFoundationFallback||n===g.n.htmlDashlingFFMPEGFallback){f+="&pretranscode=0&transcodeahead=0";if(r){(Object(v.isFeatureEnabled)(v.VideoUseCdn)||"1"===u)&&(f+="&enableCdn=1");Object(v.isFeatureEnabled)(v.VideoEnableEncryption)&&(f+="&enableEncryption=1")}}else if(n===g.n.flashDash){f+="&pretranscode=0";f+="&.ism/manifest(format=mpd-time-csf)"}if("hls-vnext"===l&&r){Object(v.isFeatureEnabled)(v.VideoUseCdnForHls)&&(f+="&enableCdn=1");Object(v.isFeatureEnabled)(v.VideoEnableEncryptionForHls)&&(f+="&enableEncryption=1")}return i.n.resolve(f)}}var c=this._pageContext,d=c.authToken,m=c.isSPO;if(!(void 0===m||m))return i.n.resolve(t.openUrl);var y=this._itemUrlHelper.getItemUrlParts(t.key),b=Object(v.isFeatureEnabled)(v.ForceProgressivePlaybackOnDownloadAspx)?0:1;if(h.e.isActivated("e8db12af-459c-49cf-9446-d363211f60ee","01/15/2021","For Gallatin clusters use direct download url without vroom call")){if(!y.isCrossDomain&&!d&&a)return this._downloadDataSource.getDownloadUrl(t,{downloadType:b})}else if(Object(p.i)()||!y.isCrossDomain&&!d&&a)return this._downloadDataSource.getDownloadUrl(t,{downloadType:b});return this._graphDataSource.getDownloadUrl(t,{useDirectEndpoint:!0})};e.prototype.fetchVTTCaptions=function(e){return Object(r.__awaiter)(this,void 0,i.n,function(){var t,n,i,s,u,a,p;return Object(r.__generator)(this,function(r){switch(r.label){case 0:t=new l.e({name:"Video.FetchVTTFile"});r.label=1;case 1:r.trys.push([1,5,,6]);return[4,this.getCaptionsSrcUrl(e)];case 2:return(n=r.sent())?[4,f.e.start({url:n,method:"GET"})]:[3,4];case 3:s=r.sent();t.end({resultType:c.e.Success});return[2,{data:s.responseText}];case 4:return[3,6];case 5:i=r.sent();s=void 0;u=void 0;if(h.e.isActivated("a1dadaf4-a088-4937-baf5-76fa11a3a288","11/22/2021","Update fetchVTTFile logging")){s=JSON.parse(i.responseText);u=s.error?s.error.message:""}else{try{s=JSON.parse(i.responseText)}catch(e){}u=s&&s.error?s.error.message:"Cannot parse error message"}a=e.urls?e.urls[o.t.mediaBaseUrl]:"";p=i;t.end({resultType:c.e.Failure,error:u,extraData:{httpStatusCode:p&&p.status,metaBaseUrl:a}});return[2,{error:{code:p&&p.status,message:u,correlationId:p.getResponseHeader&&"function"==typeof p.getResponseHeader?i.getResponseHeader("x-correlationid"):""}}];case 6:return[2]}})})};e.prototype.getCaptionsSrcUrl=function(e){return Object(r.__awaiter)(this,void 0,i.n,function(){var t,n,i,s,u,a,f,l;return Object(r.__generator)(this,function(r){switch(r.label){case 0:if(!e.urls)return[3,2];t=e.urls[o.t.mediaBaseUrl];n=e.urls[o.t.itemUrl];i=this.getParameterByName("provider",e.urls[o.t.video]);if(!t||!n)return[3,2];s="".concat(t,"/transform/transcript?provider=").concat(i);u=encodeURIComponent(n);a=this.getParameterByName("cs",e.urls[o.t.video]);return[4,this.getDriveAccessToken(e)];case 1:f=r.sent();l="".concat(s,"&docid=").concat(u,"&access_token=").concat(f);a&&(l+="&cs=".concat(a));return[2,l];case 2:return[2,void 0]}})})};e.prototype.fetchVideoMetaData=function(e){return Object(r.__awaiter)(this,void 0,i.n,function(){var t,n,i,s;return Object(r.__generator)(this,function(r){switch(r.label){case 0:t=new l.e({name:"Video.FetchMetaData"});if(!this.isMetaAvailable(e)&&!h.e.isActivated("3997c29a-38f4-487d-b8ef-fc69f7540598","02/05/2021","Disables MeTA availability check when fetching video metadata"))return[2,{error:{code:0,message:"Metadata not available in current environment.",correlationId:""}}];r.label=1;case 1:r.trys.push([1,3,,4]);return[4,this._makeVideoMetadataCall(e)];case 2:n=r.sent();t.end({resultType:c.e.Success});return[2,{data:n}];case 3:i=r.sent();s=i;t.end({resultType:c.e.Failure,error:s&&s.statusText,extraData:{httpStatusCode:s&&s.status}});return[2,{error:{code:s&&s.status,message:s&&s.statusText,correlationId:s&&s.getResponseHeader&&"function"==typeof s.getResponseHeader&&s.getResponseHeader("request-id")||""}}];case 4:return[2]}})})};e.prototype.fetchTranscripts=function(e){return this._isTranscriptVroomEnabled&&this._isTranscriptVroomEnabled()?this._fetchMediaTranscripts(e):Promise.resolve([])};e.prototype.getRequestParametersAsync=function(e,t,n,r,s){var o=this;void 0===n&&(n=!0);void 0===r&&(r=!1);void 0===s&&(s=!1);if(!t||"https://"!==t.slice(0,8))return i.n.resolve({url:t});var u=this.getParameterByName("p1",t);r&&(t=t.concat("&enhanceAudio=true"));var a=h.e.isActivated("5378e20f-3228-466c-b2cc-efd34529ad62","06/12/2022","Fix regular expression issue for video url");if(n&&null!==u&&this.isHmacExpired(u)){t=a?t.replace(/(?:&|%3F|%26|%3f)(?:access_token|tempauth|p1|p2|p3|p4)(?:=|%3d|%3D)[^&]+/g,"").replace(/(?:access_token|tempauth|p1|p2|p3|p4)(?:=|%3d|%3D)[^&]+(?:&|%26|$)/g,"").replace(/(?:\?|%3F|%3f)$/g,""):t.replace(/(?:access_token|tempauth)(?:%3d|%3D)[^&%]+(?:%26|$)?(&)?/g,"$1").replace(/(?:access_token|tempauth)(?:=)[^&]+(?:&|$)/g,"").replace(/(?:p1|p2|p3|p4)(?:=)[^&]+(?:&|$)/g,"").replace(/(?:%3F|%3f|%26)(&|$)/g,"$1").replace(/(?:\?|&)$/g,"");var f,l,c=new i.n(function(e,t){f=e;l=t});this.getDriveAccessToken(e,!0).then(function(n){o._getItemHMAC(e,t,n).then(function(e){var r="".concat(t).concat(a||-1!==t.indexOf("?")?"&":"?","access_token=").concat(n,"&p1=").concat(e.expiry,"&p2=").concat(e.symmetricKey,"&p3=").concat(e.algoId,"&p4=").concat(e.digest);f({url:r})}).catch(function(e){N.e.logError(e);l(e)})});return c}t=a?t.replace(/(?:&|%3F|%26|%3f)(?:access_token|tempauth)(?:=|%3d|%3D)[^&]+/g,"").replace(/(?:access_token|tempauth)(?:=|%3d|%3D)[^&]+(?:&|%26|$)/g,"").replace(/(?:\?|%3F|%3f)$/g,""):t.replace(/(?:access_token|tempauth)(?:%3d|%3D)[^&%]+(?:%26|$)?(&)?/g,"$1").replace(/(?:access_token|tempauth)(?:=)[^&]+(?:&|$)/g,"").replace(/(?:%3F|%3f|%26)(&|$)/g,"$1").replace(/(?:\?|&)$/g,"");return this.getDriveAccessToken(e,s).then(function(e){return{url:"".concat(t).concat(a||-1!==t.indexOf("?")?"&":"?","access_token=").concat(e)}})};e.prototype.getDriveAccessTokenVroom2_1=function(e){return Object(r.__awaiter)(this,void 0,i.n,function(){var t;return Object(r.__generator)(this,function(n){switch(n.label){case 0:return Object(v.isFeatureEnabled)(v.VideoTokenFromGraph)?[2,this.getDriveAccessToken(e,!1,"v2.1")]:[3,1];case 1:return[4,this._graphDataSource.getAccessToken(e,{apiVersion:"v2.1"})];case 2:if(t=n.sent())return[2,t.accessToken];throw new Error("Undefined access token")}})})};e.prototype.getToken=function(e,t){var n=this;if(Object(v.isFeatureEnabled)(v.VideoForcedTokenRefresh)){var r=this._cached,s=this._graphDataSource,o={apiVersion:Object(v.isFeatureEnabled)(v.MediaTAUseVroomV21)?"v2.1":"v2.0",useDirectEndpoint:!0},a=A(s.getDriveUrl(e,o));if(!t&&r&&r.driveUrl===a&&r.expiry>Date.now())return i.n.resolve(r.token);var f=function(e){if(e){var t=e&&Object(u.r)(e),r=Date.now(),s=Object(v.isFeatureEnabled)(v.VideoMoreAgressiveTokenRefresh)?300:60,o=t&&1e3*(Number(t.exp)-s);if(o&&o>r){var f={expiry:o,token:e,driveUrl:a};n._cached=f;return i.n.resolve(e)}}};if(!t){var l=s.getAccessToken(e,o),c=l&&l.accessToken,h=f(c);if(h)return h}return this._tokenFetcher.getAuthToken(e.key).then(function(e){var t,n=e.data,r=n[".driveAccessToken"],i=n[".driveAccessTokenV21"],s=n[".driveUrl"],o=n[".driveUrlV21"];s&&r&&a.indexOf(A(s))>=0?t=f(L(r)):o&&i&&a.indexOf(A(o))>=0&&(t=f(L(i)));return t||Promise.reject(new S.e({code:"NoAuth",isExpected:!1,message:"Cannot find auth token"}))})}return this._getCachedToken(e)};e.prototype.getDriveAccessToken=function(e,t,n){void 0===t&&(t=!1);return Object(r.__awaiter)(this,void 0,i.n,function(){var s,o,u;return Object(r.__generator)(this,function(r){switch(r.label){case 0:if(!Object(v.isFeatureEnabled)(v.VideoTokenFromGraph))return[3,3];s=d.optional(Object(p.i)()?void 0:n||(Object(v.isFeatureEnabled)(v.MediaTAUseVroomV21)?"v2.1":"v2.0"));return this._graphDataSource.refreshAccessToken?[4,this._graphDataSource.refreshAccessToken(e,Object(d.default)({forceRefresh:t},{apiVersion:s}))]:[3,2];case 1:if((o=r.sent())&&!h.e.isActivated("f8c9592c-65b2-445a-8a3d-2f90e0b9d74b","10/27/2021","Return refreshToken if it exists"))return[2,i.n.resolve(o.accessToken)];r.label=2;case 2:return(u=this._graphDataSource.getAccessToken(e,Object(d.default)({},{apiVersion:s})))?[2,i.n.resolve(u.accessToken)]:[2,i.n.reject(new S.e({code:"NoAuth",isExpected:!1,message:"Cannot find auth token"}))];case 3:return[2,this.getToken(e,t)]}})})};e.prototype._fetchMediaTranscripts=function(e){return Object(r.__awaiter)(this,void 0,i.n,function(){var t,n,i,s,u,a,h,p,d,v;return Object(r.__generator)(this,function(r){switch(r.label){case 0:t=new l.e({name:"Video.FetchMediaTranscripts"});r.label=1;case 1:r.trys.push([1,4,,5]);n=new C.t(e.urls[o.t.itemUrl].replace("/_api/v2.0/","/_api/v2.1/"));return[4,this.getDriveAccessTokenVroom2_1(e)];case 2:i=r.sent();n.setPath("".concat(n.getPath(!0),"/media/transcripts"));n.setQueryParameter("access_token",i);n.removeQueryParameter("version");return[4,f.e.start({url:n.toString(),method:"GET"})];case 3:s=r.sent();u=function(e,t){return"source"===e?t.toLowerCase():t};a=JSON.parse(s.responseText,u);t.end({resultType:c.e.Success});return[2,a&&a.value?a.value:void 0];case 4:if((h=r.sent())instanceof XMLHttpRequest){d=(p=h)&&p.getResponseHeader&&"function"==typeof p.getResponseHeader&&p.getResponseHeader("request-id")||"";t.end({resultType:c.e.Failure,error:p&&p.statusText,extraData:{httpStatusCode:p&&p.status,correlationId:d}});return[2,Promise.reject({error:{code:p&&p.status,message:p&&p.statusText,correlationId:d}})]}v="Transcripts failed to fetch, an error occurred outside of the request";t.end({resultType:c.e.Failure,error:v,extraData:{typeofError:typeof h}});return[2,Promise.reject({error:{code:0,message:v,correlationId:""}})];case 5:return[2]}})})};e.prototype._makeVideoMetadataCall=function(e){return Object(r.__awaiter)(this,void 0,i.n,function(){var t,n,i,s,u;return Object(r.__generator)(this,function(r){switch(r.label){case 0:t=new C.t(e.urls[o.t.itemUrl]);return[4,this.getDriveAccessToken(e)];case 1:n=r.sent();i={};t.setQueryParameter("access_token",n);t.setQueryParameter("select","media,source,sharepointIds,commentSettings");return[4,f.e.start({url:t.toString(),method:"GET"})];case 2:s=r.sent();(i=JSON.parse(s.responseText)).spRequestDuration=parseInt(s.getResponseHeader("spclientservicerequestduration"),10);(u=s.getResponseHeader("x-cache"))&&(i.isCdnHit="CONFIG_NOCACHE"!==u);return[2,i]}})})};e.prototype.getParameterByName=function(e,t){var n=RegExp("[?&]"+e+"=([^&]*)").exec(t);return n&&decodeURIComponent(n[1].replace(/\+/g," "))};e.prototype.isHmacExpired=function(e){void 0===e&&(e="0");var t=Object(v.isFeatureEnabled)(v.VideoMoreAgressiveTokenRefresh)?300:60;return e<(Date.now()/1e3+t).toString()};e.prototype._getItemHMAC=function(e,t,n){if(e&&e.hmac&&!this.isHmacExpired(e.hmac.expiry))return new i.n(function(t,n){t(e.hmac)});var r=this.getParameterByName("provider",t),s=n,o=this.getParameterByName("docId",t),u=document.createElement("a");u.href=t;var a,f=u.pathname,l=u.origin;l+=f.replace("videotranscode","renewurlsigningContract");a={provider:r||"",access_token:s,docId:o||"",apiUrlPath:f,url:l};return this._graphDataSource.getHmacHash(e,a)};e.prototype._getCachedToken=function(e){var t=this,n=this._cached,r=this._graphDataSource,s={apiVersion:Object(v.isFeatureEnabled)(v.MediaTAUseVroomV21)?"v2.1":"v2.0",useDirectEndpoint:!0},o=A(r.getDriveUrl(e,s));if(n&&n.driveUrl===o&&n.expiry>Date.now())return i.n.resolve(n.token);var a=function(e){if(e){var n=e&&Object(u.r)(e),r=Date.now(),s=Object(v.isFeatureEnabled)(v.VideoMoreAgressiveTokenRefresh)?300:60,a=n&&1e3*(Number(n.exp)-s);if(a&&a>r){var f={expiry:a,token:e,driveUrl:o};t._cached=f;return i.n.resolve(e)}}},f=r.getAccessToken(e,s),l=f&&f.accessToken,c=a(l);return c||this._tokenFetcher.getAuthToken(e.key).then(function(e){var t,n=e.data,r=n[".driveAccessToken"],i=n[".driveAccessTokenV21"],s=n[".driveUrl"],u=n[".driveUrlV21"];s&&r&&o.indexOf(A(s))>=0?t=a(L(r)):u&&i&&o.indexOf(A(u))>=0&&(t=a(L(i)));return t||Promise.reject(new S.e({code:"NoAuth",isExpected:!1,message:"Cannot find auth token"}))})};e.prototype._getFormat=function(e){return e===g.n.htmlDashling||e===g.n.htmlDashlingMediaFoundationFallback||e===g.n.flashDash||e===g.n.htmlDashlingFFMPEGFallback?"dash":e===g.n.htmlHlsV6||e===g.n.htmlHlsV6MediaFoundationFallback||e===g.n.htmlHlsV6FFMPEGFallback?"hls-vnext":void 0};return e})();t.default=k;function L(e){if(e.indexOf("=")<0)return e;var t=Object(x.e)(e);return t&&t.access_token}function A(e){if(!e)return e;var t=new T.e(e.toLowerCase());return"".concat(t.authority.replace(/:443$/g,"")).concat(t.path)}var O=Object(s.s)("VideoItemDataSource",k,{downloadDataSource:y.a,graphDataSource:y.w,itemUrlHelper:w.a,pageContext:b.h,tokenFetcher:E.e,isTranscriptVroomEnabled:m.t})}}]);