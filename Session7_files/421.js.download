(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[421],{3907:function(e,t,n){"use strict";n.d(t,"e",function(){return r});function r(e){var t=e.serverRelativeItemUrl,n=e.dataRequestor,r=e.webApiUrl,i=e.duration,s=void 0===i?1:i,o=e.authToken,u=r;u=(u=u.methodWithAliases("GetFileByServerRelativePath",{DecodedUrl:t})).method("GetPreAuthorizedAccessUrl",s);return n.getData({url:u.toString(),method:"GET",authToken:o,qosName:"ItemDataSource.getDownloadUrl"}).then(function(e){return e.d.GetPreAuthorizedAccessUrl})}},4948:function(e,t,n){"use strict";n.r(t);n.d(t,"resourceKey",function(){return M});var r,i=n(0),s=n(530),o=n(91);(function(e){e[e.download=0]="download";e[e.view=1]="view";e[e.load=2]="load";e[e.share=3]="share"})(r||(r={}));var u=r,a=n(373),f=n(111),l=n(670),c=n(427),h=n(354),p=n(3907),d=n(778),v=(function(e){Object(i.__extends)(t,e);function t(t){var n=e.call(this,{},{pageContext:t})||this;n._itemUrlHelper=new a.e({},{pageContext:t});n._apiUrlHelper=new l.e({},{pageContext:t,itemUrlHelper:n._itemUrlHelper});return n}t.prototype.downloadItems=function(e){var t=e.items[0];return this.getDownloadUrl(t,null,{downloadType:u.download}).then(function(e){window.location.href=e})};t.prototype.getDownloadUrl=function(e,t,n){var r=this;void 0===n&&(n={});var i=n.downloadType,s=void 0===i?u.download:i,a=this._itemUrlHelper.getItemUrlParts(e.key);if(s===u.view)return o.n.resolve(Object(d.e)(a.fullItemUrl));if(s===u.share){var l=void 0;l=e.video?24:1;var v=this._apiUrlHelper.build().webByItemUrl(a);return Object(p.e)({dataRequestor:this.dataRequestor,webApiUrl:v,duration:l,serverRelativeItemUrl:a.serverRelativeItemUrl})}if(s===u.load)return a.isCrossDomain&&n.authToken?this.dataRequestor.getData({url:this._apiUrlHelper.contextInfoUrl(a.fullItemUrl),method:"POST",qosName:"GetContextInfo",authToken:n.authToken}).then(function(e){var t=e.d.GetContextWebInformation.WebFullUrl,n=new c.t({webAbsoluteUrl:t}).build().segment("web").methodWithAliases("GetFileByServerRelativePath",{DecodedUrl:a.serverRelativeItemUrl}).segment("OpenBinaryStream");return o.n.resolve(n.toString())}):o.n.resolve(this.getBinaryStreamApiUrl(a).toString());var m=void 0;if(t||a.siteRelation===f.r.sameSite){var g=void 0;if(t){g=this._itemUrlHelper.getItemUrlParts(t.key).fullItemUrl}else g=this._pageContext.webAbsoluteUrl;m=o.n.resolve(g)}else m=this.dataRequestor.getData({url:this._apiUrlHelper.contextInfoUrl(a.fullItemUrl),method:"POST",qosName:"GetContextInfo"}).then(function(e){return e.d.GetContextWebInformation.WebFullUrl});return m.then(function(e){return"".concat(e,"/").concat(r._pageContext.layoutsUrl,"/download.aspx?").concat(Object(h.e)({SourceUrl:a.serverRelativeItemUrl}))})};t.prototype.getBinaryStreamApiUrl=function(e){var t=this._apiUrlHelper.build().webByItemUrl(e);t=(t=t.methodWithAliases("GetFileByServerRelativePath",{DecodedUrl:e.serverRelativeItemUrl})).segment("OpenBinaryStream");var n=this._pageContext.authToken;n&&(t=t.oDataParameter("access_token",n));return t};return t})(s.t),m=n(598),g=n(140),y=n(119),b=n(1255),w=n(2059),E=n(82),S=n(36),x=n(33),T=n(2411),N=n(202),C=n(196),k=n(425),L=n(29),A=n(13),O=(function(){function e(e,t){this._common=new v(t.pageContext);this._dataRequestor=new t.dataRequestorType({});this._graphDataSource=t.graphDataSource;this._itemParentHelper=t.itemParentHelper;this._navigation=t.navigation;this._itemUrlHelper=t.itemUrlHelper;this._identityDataSource=t.identityDataSource}e.prototype.getDownloadUrl=function(e,t){void 0===t&&(t={});var n=Object(m.r)(this._itemParentHelper.getFacetedAncestorOrSelf(e,"subsite"));return this._common.getDownloadUrl(Object(T.n)(e),Object(T.n)(n),t)};e.prototype.getItemContents=function(e){var t=this;return this.getDownloadRequestParameters(e).then(function(e){var n=e.headers,r=n&&n.Authorization,i=r&&r.slice(7);return t._dataRequestor.getData({url:e.url,method:"GET",noRedirect:!0,qosName:"ItemDataSource.getItemContents",responseType:"blob",needsRequestDigest:!1,authToken:i})})};e.prototype.getDownloadRequestParameters=function(e,t){var n=this,r=this._itemUrlHelper.getItemUrlParts(e.key),i=new C.e(r.normalizedItemUrl);return r.isCrossDomain?this._identityDataSource.getSharePointToken(i.authority).then(function(t){var r=t.accessToken;return n.getDownloadUrl(e,{downloadType:2,authToken:r}).then(function(e){return{url:e,headers:{Authorization:"bearer ".concat(r)}}})}):this.getDownloadUrl(e,{downloadType:2}).then(function(e){return{url:e,withCredentials:!0}})};e.prototype.downloadItems=function(e){var t=this,n=e.items[0];return(Object(x.isFeatureEnabled)(x.UseVroomDownload)?this._graphDataSource.getDownloadUrl(n,{useDirectEndpoint:!0}):this.getDownloadUrl(n,{downloadType:0})).then(function(e){if(A.e.isActivated("f00a3568-c0f5-401d-b8da-584dfc24d99f","06/28/2021","Excel download issue"))t._navigation.navigateTo(e);else{var n=t._initIframe(e);setTimeout(function(){window.document.body.removeChild(n)},2e4)}})};e.prototype.isDownloadBlocked=function(e){return!L.e.hasPermission(e.permissions,L.e.openItems)};e.prototype._initIframe=function(e){var t=document.createElement("iframe");t.src=e;t.style.display="none";window.document.body.appendChild(t);return t};return e})(),M=(t.default=O,Object(y.s)("DownloadDataSource",O,{dataRequestorType:b.n,graphDataSource:E.w,itemParentHelper:w.e,navigation:g.e,pageContext:S.h,itemUrlHelper:N.a,identityDataSource:k.t}))}}]);